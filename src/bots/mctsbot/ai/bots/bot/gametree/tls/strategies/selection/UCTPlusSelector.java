package bots.mctsbot.ai.bots.bot.gametree.tls.strategies.selection;

import bots.mctsbot.ai.bots.bot.gametree.tls.nodes.AbstractTLSNode;

public class UCTPlusSelector extends SelectionStrategy {

	private final double C1;
	private final double C2;

	public UCTPlusSelector(double C1, double C2) {
		this.C1 = C1;
		this.C2 = C2;
	}

	@Override
	public AbstractTLSNode select(AbstractTLSNode innerNode) {
		AbstractTLSNode leftChild = innerNode.getLeftChild();
		double leftValue = evaluate(innerNode.getLeftChild());

		AbstractTLSNode rightChild = innerNode.getRightChild();
		if (rightChild == null)
			return leftChild;

		if (evaluate(rightChild) >= leftValue)
			return rightChild;

		return leftChild;
	}

	protected double evaluate(AbstractTLSNode node) {
		int nbSamples = node.getNbSamples();
		if (nbSamples == 0)
			return 0;
		int nbParentSamples = node.getParent().getNbSamples();
		double stdDev = node.getEVStdDev();
		return node.getEV() + C1 * Math.sqrt(Math.log(nbParentSamples) / nbSamples) + C2 * stdDev;
	}
}

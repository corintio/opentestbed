package game;

import static org.junit.Assert.assertEquals;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.StringWriter;
import java.util.Date;
import java.util.GregorianCalendar;

import org.junit.Test;

public class HandHistoryWriterTest {
	/**
	 * Tests against file 'full-tilt-hh1.txt'. This is a pretty standard file
	 */
	@Test
	public void testFTSampleHistory1() throws Exception {
		String exampleFile = readResourceToString("./full-tilt-hh1.txt");

		// setup games and players
		PublicGameInfo gameInfo = new PublicGameInfo();
		gameInfo.setGameID(1111);
		gameInfo.setBigBlind(0.02);
		gameInfo.setSmallBlind(0.01);
		gameInfo.setLimit(PublicGameInfo.NO_LIMIT);

		gameInfo.setNumSeats(9);
		gameInfo.setPlayer(0, PublicPlayerInfo.create("player1", 0.33));
		gameInfo.setPlayer(2, PublicPlayerInfo.create("player3", 0.42));
		gameInfo.setPlayer(4, PublicPlayerInfo.create("player5", 0.42));
		gameInfo.setPlayer(5, PublicPlayerInfo.create("player6", 0.85));
		gameInfo.setPlayer(6, PublicPlayerInfo.create("player7", 0.76));
		gameInfo.setPlayer(7, PublicPlayerInfo.create("player8", 0.40));
		gameInfo.setPlayer(8, PublicPlayerInfo.create("player9", 1.57));
		
		StringWriter handHistory = new StringWriter();
		HandHistoryWriter handHistoryWriter = new MockHandHistoryWriter();
		handHistoryWriter.setWriter(handHistory);

		// simulate events of a game
		handHistoryWriter.gameStartEvent(gameInfo);
		handHistoryWriter.gameOverEvent();

		assertEquals(exampleFile, handHistory.toString());
	}


	/**
	 * Tests against file 'full-tilt-hh2.txt'. A side pot is built which one player gets.
	 */
	@Test
	public void testFTSampleHistory2() {
		// to be done

	}

	/**
	 * Tests against file 'full-tilt-hh3.txt'. A side pot is built and side+main pot are split among three players.
	 */
	@Test
	public void testFTSampleHistory3() {
		// to be done
	}

	/**
	 * when I need this the next time, I include commons-io.jar :) ...
	 */
	private String readResourceToString(String resourceName) throws IOException {
		StringBuffer contentOfFile = new StringBuffer();
		BufferedReader inputReader = new BufferedReader(new InputStreamReader(getClass().getResourceAsStream("./full-tilt-hh1.txt")));
		String line;
		while ((line = inputReader.readLine()) != null) {
			contentOfFile.append(line).append("\n");
		}
		return contentOfFile.toString();
	}

	/**
	 * overrides 'getGameTime()', otherwíse the generated histories always have different times
	 */
	static class MockHandHistoryWriter extends HandHistoryWriter {
		@Override
		protected Date getGameTime() {
			return new GregorianCalendar(2000, 0, 1).getTime();
		}

	}
}
